"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const express_1 = tslib_1.__importDefault(require("express"));
const brreg_1 = require("../lib/brreg");
const app = (0, express_1.default)();
async function applyRoles(company) {
    company.rollegrupper = await (0, brreg_1.getCompanyRoles)(company.organisasjonsnummer);
    return company;
}
app.get('/search', async (req, res) => {
    const { query } = req.query;
    const start = Date.now();
    if (!query)
        return res.status(400).send('Query is required.');
    const companies = await (0, brreg_1.searchCompanies)(query);
    for (const company of companies)
        await applyRoles(company);
    return res
        .header('x-time-taken', `${Date.now() - start}`)
        .header('x-count', `${companies.length}`)
        .json(companies);
});
app.get('/find', async (req, res) => {
    const { query } = req.query;
    const start = Date.now();
    if (!query)
        return res.status(400).send('Query is required.');
    const company = await (0, brreg_1.findCompany)(query);
    res.header('x-time-taken', `${Date.now() - start}`);
    if (company)
        return res
            .json(await applyRoles(company));
    else
        return res
            .status(404)
            .send(`Company with name ${query} not found.`);
});
app.get('/no/:orgno', async (req, res) => {
    const orgno = req.params.orgno;
    const company = await (0, brreg_1.getCompany)(orgno);
    const start = Date.now();
    if (company)
        res
            .header('x-time-taken', `${Date.now() - start}`)
            .json(await applyRoles(company));
    else
        res
            .status(404)
            .send(`Company with id ${orgno} not found.`);
});
exports.default = async () => {
    const port = process.env.PORT || 3000;
    const verbose = true;
    await (0, brreg_1.init)({ verbose });
    await (0, brreg_1.initRoles)({ verbose });
    //await Promise.all([
    //    init({verbose}),
    //    initRoles({verbose})
    //])    
    app.listen(port);
    console.log(`Listening on port ${port}`);
    return app;
};
<<<<<<< HEAD
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3JlYXRlU2VydmVyLmpzIiwic291cmNlUm9vdCI6Ii4vc3JjLyIsInNvdXJjZXMiOlsic3JjL3NlcnZlci9jcmVhdGVTZXJ2ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsOERBQW9EO0FBRXBELHdDQUF5RztBQUV6RyxNQUFNLEdBQUcsR0FBRyxJQUFBLGlCQUFPLEdBQUUsQ0FBQTtBQUNyQixLQUFLLFVBQVUsVUFBVSxDQUFDLE9BQWlCO0lBQ3ZDLE9BQU8sQ0FBQyxZQUFZLEdBQUcsTUFBTSxJQUFBLHVCQUFlLEVBQUMsT0FBTyxDQUFDLG1CQUFtQixDQUFDLENBQUE7SUFDekUsT0FBTyxPQUFPLENBQUE7QUFDbEIsQ0FBQztBQUNELEdBQUcsQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFLEtBQUssRUFBRSxHQUFZLEVBQUUsR0FBYSxFQUFFLEVBQUU7SUFDckQsTUFBTSxFQUFFLEtBQUssRUFBRSxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUE7SUFDM0IsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFBO0lBQ3hCLElBQUksQ0FBQyxLQUFLO1FBQ04sT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxDQUFBO0lBRXJELE1BQU0sU0FBUyxHQUFHLE1BQU0sSUFBQSx1QkFBZSxFQUFDLEtBQWUsQ0FBQyxDQUFBO0lBQ3hELEtBQUssTUFBTSxPQUFPLElBQUksU0FBUztRQUMzQixNQUFNLFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQTtJQUM3QixPQUFPLEdBQUc7U0FDTCxNQUFNLENBQUMsY0FBYyxFQUFFLEdBQUcsSUFBSSxDQUFDLEdBQUcsRUFBRSxHQUFHLEtBQUssRUFBRSxDQUFDO1NBQy9DLE1BQU0sQ0FBQyxTQUFTLEVBQUUsR0FBRyxTQUFTLENBQUMsTUFBTSxFQUFFLENBQUM7U0FDeEMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFBO0FBQ3hCLENBQUMsQ0FBQyxDQUFBO0FBRUYsR0FBRyxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsS0FBSyxFQUFFLEdBQVksRUFBRSxHQUFhLEVBQUUsRUFBRTtJQUNuRCxNQUFNLEVBQUUsS0FBSyxFQUFFLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQTtJQUMzQixNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUE7SUFDeEIsSUFBSSxDQUFDLEtBQUs7UUFDTixPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLG9CQUFvQixDQUFDLENBQUE7SUFFckQsTUFBTSxPQUFPLEdBQUcsTUFBTSxJQUFBLG1CQUFXLEVBQUMsS0FBZSxDQUFDLENBQUE7SUFDbEQsR0FBRyxDQUFDLE1BQU0sQ0FBQyxjQUFjLEVBQUUsR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLEdBQUcsS0FBSyxFQUFFLENBQUMsQ0FBQTtJQUNuRCxJQUFJLE9BQU87UUFDUCxPQUFPLEdBQUc7YUFDTCxJQUFJLENBQUMsTUFBTSxVQUFVLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQTs7UUFFcEMsT0FBTyxHQUFHO2FBQ0wsTUFBTSxDQUFDLEdBQUcsQ0FBQzthQUNYLElBQUksQ0FBQyxxQkFBcUIsS0FBSyxhQUFhLENBQUMsQ0FBQTtBQUMxRCxDQUFDLENBQUMsQ0FBQTtBQUVGLEdBQUcsQ0FBQyxHQUFHLENBQUMsWUFBWSxFQUFFLEtBQUssRUFBRSxHQUFZLEVBQUUsR0FBYSxFQUFFLEVBQUU7SUFDeEQsTUFBTSxLQUFLLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUE7SUFDOUIsTUFBTSxPQUFPLEdBQUcsTUFBTSxJQUFBLGtCQUFVLEVBQUMsS0FBSyxDQUFDLENBQUE7SUFDdkMsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFBO0lBQ3hCLElBQUksT0FBTztRQUNQLEdBQUc7YUFDRSxNQUFNLENBQUMsY0FBYyxFQUFFLEdBQUcsSUFBSSxDQUFDLEdBQUcsRUFBRSxHQUFHLEtBQUssRUFBRSxDQUFDO2FBQy9DLElBQUksQ0FBQyxNQUFNLFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFBOztRQUVwQyxHQUFHO2FBQ0UsTUFBTSxDQUFDLEdBQUcsQ0FBQzthQUNYLElBQUksQ0FBQyxtQkFBbUIsS0FBSyxhQUFhLENBQUMsQ0FBQTtBQUN4RCxDQUFDLENBQUMsQ0FBQTtBQUVGLGtCQUFlLEtBQUssSUFBSSxFQUFFO0lBQ3RCLE1BQU0sSUFBSSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQTtJQUNyQyxNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUE7SUFDcEIsTUFBTSxJQUFBLFlBQUksRUFBQyxFQUFDLE9BQU8sRUFBQyxDQUFDLENBQUE7SUFDckIsTUFBTSxJQUFBLGlCQUFTLEVBQUMsRUFBQyxPQUFPLEVBQUMsQ0FBQyxDQUFBO0lBQzFCLHFCQUFxQjtJQUNyQixzQkFBc0I7SUFDdEIsMEJBQTBCO0lBQzFCLFFBQVE7SUFDUixHQUFHLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFBO0lBQ2hCLE9BQU8sQ0FBQyxHQUFHLENBQUMscUJBQXFCLElBQUksRUFBRSxDQUFDLENBQUE7SUFDeEMsT0FBTyxHQUFHLENBQUE7QUFDZCxDQUFDLENBQUEifQ==
=======
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3JlYXRlU2VydmVyLmpzIiwic291cmNlUm9vdCI6Ii4vc3JjLyIsInNvdXJjZXMiOlsic3JjL3NlcnZlci9jcmVhdGVTZXJ2ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsOERBQW9EO0FBQ3BELHdDQUE2RTtBQUU3RSxNQUFNLEdBQUcsR0FBRyxJQUFBLGlCQUFPLEdBQUUsQ0FBQTtBQUVyQixHQUFHLENBQUMsR0FBRyxDQUFDLFNBQVMsRUFBRSxLQUFLLEVBQUUsR0FBWSxFQUFFLEdBQWEsRUFBRSxFQUFFO0lBQ3JELE1BQU0sRUFBRSxLQUFLLEVBQUUsR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFBO0lBQzNCLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQTtJQUN4QixJQUFJLENBQUMsS0FBSztRQUNOLE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsb0JBQW9CLENBQUMsQ0FBQTtJQUVyRCxNQUFNLFNBQVMsR0FBRyxNQUFNLElBQUEsdUJBQWUsRUFBQyxLQUFlLENBQUMsQ0FBQTtJQUN4RCxPQUFPLEdBQUc7U0FDTCxNQUFNLENBQUMsY0FBYyxFQUFFLEdBQUcsSUFBSSxDQUFDLEdBQUcsRUFBRSxHQUFHLEtBQUssRUFBRSxDQUFDO1NBQy9DLE1BQU0sQ0FBQyxTQUFTLEVBQUUsR0FBRyxTQUFTLENBQUMsTUFBTSxFQUFFLENBQUM7U0FDeEMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFBO0FBQ3hCLENBQUMsQ0FBQyxDQUFBO0FBRUYsR0FBRyxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsS0FBSyxFQUFFLEdBQVksRUFBRSxHQUFhLEVBQUUsRUFBRTtJQUNuRCxNQUFNLEVBQUUsS0FBSyxFQUFFLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQTtJQUMzQixNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUE7SUFDeEIsSUFBSSxDQUFDLEtBQUs7UUFDTixPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLG9CQUFvQixDQUFDLENBQUE7SUFFckQsTUFBTSxPQUFPLEdBQUcsTUFBTSxJQUFBLG1CQUFXLEVBQUMsS0FBZSxDQUFDLENBQUE7SUFDbEQsR0FBRyxDQUFDLE1BQU0sQ0FBQyxjQUFjLEVBQUUsR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLEdBQUcsS0FBSyxFQUFFLENBQUMsQ0FBQTtJQUNuRCxJQUFJLE9BQU87UUFDUCxPQUFPLEdBQUc7YUFDTCxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUE7O1FBRWxCLE9BQU8sR0FBRzthQUNMLE1BQU0sQ0FBQyxHQUFHLENBQUM7YUFDWCxJQUFJLENBQUMscUJBQXFCLEtBQUssYUFBYSxDQUFDLENBQUE7QUFDMUQsQ0FBQyxDQUFDLENBQUE7QUFFRixHQUFHLENBQUMsR0FBRyxDQUFDLFlBQVksRUFBRSxLQUFLLEVBQUUsR0FBWSxFQUFFLEdBQWEsRUFBRSxFQUFFO0lBQ3hELE1BQU0sS0FBSyxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFBO0lBQzlCLE1BQU0sT0FBTyxHQUFHLE1BQU0sSUFBQSxrQkFBVSxFQUFDLEtBQUssQ0FBQyxDQUFBO0lBQ3ZDLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQTtJQUN4QixJQUFJLE9BQU87UUFDUCxHQUFHO2FBQ0UsTUFBTSxDQUFDLGNBQWMsRUFBRSxHQUFHLElBQUksQ0FBQyxHQUFHLEVBQUUsR0FBRyxLQUFLLEVBQUUsQ0FBQzthQUMvQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUE7O1FBRWxCLEdBQUc7YUFDRSxNQUFNLENBQUMsR0FBRyxDQUFDO2FBQ1gsSUFBSSxDQUFDLG1CQUFtQixLQUFLLGFBQWEsQ0FBQyxDQUFBO0FBQ3hELENBQUMsQ0FBQyxDQUFBO0FBRUYsa0JBQWUsS0FBSyxJQUFJLEVBQUU7SUFDdEIsTUFBTSxJQUFJLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFBO0lBQ3JDLE1BQU0sSUFBQSxZQUFJLEVBQUMsRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQTtJQUM3QixHQUFHLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFBO0lBQ2hCLE9BQU8sQ0FBQyxHQUFHLENBQUMscUJBQXFCLElBQUksRUFBRSxDQUFDLENBQUE7SUFDeEMsT0FBTyxHQUFHLENBQUE7QUFDZCxDQUFDLENBQUEifQ==
>>>>>>> 56133cc8d9485d8c5e661fa54e11494479704e69
